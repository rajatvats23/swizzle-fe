<div class="flex flex-col flex-1 min-h-0 bg-gray-50">

  <!-- Header -->
  <div class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between shrink-0">
    <div>
      <h1 class="text-xl font-semibold text-gray-900">Customers</h1>
      <p class="text-sm text-gray-500 mt-0.5">{{ filteredCustomers().length }} unique customer{{ filteredCustomers().length !== 1 ? 's' : '' }}</p>
    </div>
    <button (click)="loadCustomers()"
      class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
      <span class="material-symbols-outlined text-[18px]">refresh</span>
      Refresh
    </button>
  </div>

  <!-- Search -->
  <div class="bg-white border-b border-gray-200 px-6 py-3 shrink-0">
    <div class="relative max-w-sm">
      <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-[18px]">search</span>
      <input type="text" placeholder="Search by name or phoneâ€¦"
        [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)"
        class="w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0a2e1a]/20 focus:border-[#0a2e1a]" />
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-auto">
    @if (loading()) {
      <div class="flex items-center justify-center h-48 text-gray-400">
        <span class="material-symbols-outlined animate-spin text-3xl">progress_activity</span>
      </div>
    } @else if (filteredCustomers().length === 0) {
      <div class="flex flex-col items-center justify-center h-48 text-gray-400 gap-2">
        <span class="material-symbols-outlined text-4xl">group</span>
        <p class="text-sm">No customers found</p>
      </div>
    } @else {
      <table class="w-full text-sm">
        <thead class="bg-gray-50 border-b border-gray-200 sticky top-0 z-10">
          <tr>
            <th class="text-left px-6 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Customer</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Phone</th>
            <th class="text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Orders</th>
            <th class="text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Paid Orders</th>
            <th class="text-right px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Total Spent</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">First Order</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide">Last Order</th>
            <th class="text-left px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          @for (customer of filteredCustomers(); track customer._id) {
            <tr class="bg-white hover:bg-gray-50 transition-colors">

              <!-- Avatar + name -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-full flex items-center justify-center text-sm font-semibold shrink-0 {{ avatarColor(customer.phoneNumber) }}">
                    {{ initials(customer) }}
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">{{ customer.customerName || 'Unknown' }}</p>
                    @if (isRepeat(customer)) {
                      <span class="inline-flex items-center gap-0.5 text-[10px] font-semibold text-amber-600 bg-amber-50 px-1.5 py-0.5 rounded-full mt-0.5">
                        <span class="material-symbols-outlined text-[10px]">star</span>
                        Repeat
                      </span>
                    }
                  </div>
                </div>
              </td>

              <td class="px-4 py-4 font-mono text-gray-500">{{ customer.phoneNumber }}</td>
              <td class="px-4 py-4 text-right text-gray-700 font-medium">{{ customer.totalOrders }}</td>
              <td class="px-4 py-4 text-right">
                <span class="text-emerald-700 font-medium">{{ paidCount(customer) }}</span>
                <span class="text-gray-400 text-xs"> / {{ customer.totalOrders }}</span>
              </td>
              <td class="px-4 py-4 text-right font-semibold text-gray-900">{{ formatCurrency(customer.totalSpent) }}</td>
              <td class="px-4 py-4 text-gray-400 text-xs">{{ formatDate(customer.firstOrderAt) }}</td>
              <td class="px-4 py-4 text-gray-400 text-xs">{{ formatDate(customer.lastOrderAt) }}</td>
              <td class="px-4 py-4"></td>
            </tr>
          }
        </tbody>
      </table>
    }
  </div>

</div>
