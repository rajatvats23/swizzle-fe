<div class="address-container">
  
  <!-- Header -->
  <header class="address-header">
    <button (click)="goBack()" class="back-button">
      <span class="material-symbols-outlined">arrow_back</span>
    </button>
    <h1 class="header-title">Delivery Address</h1>
  </header>

  <!-- Main Content: Map + Form -->
  <main class="address-main">
    
    <!-- Map Section -->
    <div class="map-section">
      @if (mapLoaded()) {
        <google-map
          [center]="mapCenter()"
          [zoom]="15"
          [options]="mapOptions"
          (mapClick)="onMapClick($event)"
          width="100%"
          height="100%"
        >
          <map-marker
            [position]="markerPosition()"
            [options]="{ draggable: true }"
            (mapDragend)="onMarkerDragEnd($event)"
          />
        </google-map>
      } @else {
        <div class="map-loading">
          <p>Loading map...</p>
        </div>
      }

      <!-- Map Controls -->
      <div class="map-controls">
        <button (click)="getCurrentLocation()" class="map-control-btn" title="My Location">
          <span class="material-symbols-outlined">my_location</span>
        </button>
      </div>

      <!-- Map Overlay (for visual effect) -->
      <div class="map-overlay"></div>
    </div>

    <!-- Form Section -->
    <div class="form-section">
      <div class="form-content">
        
        <!-- Header Text -->
        <div class="form-header">
          <h2 class="form-title">Where should we deliver?</h2>
          <p class="form-subtitle">Adjust the pin or enter details below</p>
        </div>

        @if (errorMessage()) {
          <div class="error-message">
            <span class="material-symbols-outlined">error</span>
            <span>{{ errorMessage() }}</span>
          </div>
        }

        <!-- Form Fields -->
        <div class="form-fields">
          
          <!-- Full Address -->
          <div class="field-group">
            <label class="field-label">Full Address</label>
            <textarea
              [(ngModel)]="fullAddress"
              rows="3"
              placeholder="Address will auto-fill when you move the pin..."
              class="field-textarea"
            ></textarea>
          </div>

          <!-- House/Flat Number -->
          <div class="field-group">
            <label class="field-label">House/Flat Number</label>
            <div class="field-with-icon">
              <span class="material-symbols-outlined field-icon">home</span>
              <input
                type="text"
                [(ngModel)]="houseNumber"
                placeholder="e.g., 123, Block A"
                class="field-input"
              />
            </div>
          </div>

          <!-- Street/Area -->
          <div class="field-group">
            <label class="field-label">Street/Area</label>
            <input
              type="text"
              [(ngModel)]="street"
              placeholder="e.g., Green Park, Sector 7"
              class="field-input"
            />
          </div>

          <!-- Landmark (Optional) -->
          <div class="field-group">
            <label class="field-label">
              Landmark 
              <span class="optional-tag">(Optional)</span>
            </label>
            <input
              type="text"
              [(ngModel)]="landmark"
              placeholder="e.g., Near Metro Station"
              class="field-input"
            />
          </div>

          <!-- Delivery Info -->
          <div class="delivery-info">
            <div class="info-item">
              <span class="material-symbols-outlined">check_circle</span>
              <span>Verified delivery zone</span>
            </div>
            <div class="info-item">
              <span class="material-symbols-outlined">schedule</span>
              <span>Estimated delivery: 25-35 mins</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button
            (click)="saveAndContinue()"
            [disabled]="loading()"
            class="btn btn-primary"
          >
            <span>{{ loading() ? 'Saving...' : 'Continue to Menu' }}</span>
            <span class="material-symbols-outlined">arrow_forward</span>
          </button>
          
          <button (click)="skipForNow()" class="btn-text">
            Skip for Now
          </button>
        </div>

      </div>
    </div>

  </main>

</div>